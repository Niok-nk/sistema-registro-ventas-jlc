---
import DashboardLayout from "../../layouts/DashboardLayout.astro";
import DistributorManager from "../../components/dashboard/distribuidores/DistributorManager.astro";
import DistributorUsersPopup from "../../components/dashboard/distribuidores/DistributorUsersPopup.astro";
import UserProfilePopup from "../../components/usuarios/UserProfilePopup.astro";
---

<DashboardLayout title="Gestión de Distribuidores">
  <DistributorManager />
  <DistributorUsersPopup />
  <UserProfilePopup />
</DashboardLayout>

<script is:inline>
  // Verificar que el usuario sea administrador
  (function () {
    try {
      const userStr = localStorage.getItem("user");
      if (!userStr) {
        console.warn("No user data found, redirecting to login");
        window.location.href = "/login";
        return;
      }

      const user = JSON.parse(userStr);
      if (
        user.rol !== "admin" &&
        user.rol !== "administrador" &&
        user.rol !== "auditor"
      ) {
        console.warn("User is not admin/auditor, redirecting to dashboard");
        alert(
          "Acceso denegado. Esta página es solo para administradores y auditores.",
        );
        window.location.href = "/dashboard";
      }
    } catch (e) {
      console.error("Error checking admin role:", e);
      window.location.href = "/login";
    }
  })();
</script>
